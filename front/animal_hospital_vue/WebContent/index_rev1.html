<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <script src='./WEB-INF/lib/main.js'></script>
    <link href='./WEB-INF/lib/main.css' rel='stylesheet' />
    <link rel='stylesheet' href='rev_css.css'>
    <link rel='stylesheet' href='./CSS/default.css'>
    <link rel='stylesheet' href='./CSS/intro.css'>
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>
    <script src="./source/includeHTML.js"></script>
    <script src="./source/isLogin.js"></script>
    <script src="https://unpkg.com/vue"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            var date = new Date();
            dates = [];
            var date = new Date();
            const date1 = new Date(date.getFullYear(), date.getMonth(), date.getDate());
            const date2 = new Date(date.getFullYear(), date.getMonth(), Number(date.getDate()) + 30);
            for (let index = 0; index < (date2 - date1) / (3600 * 24 * 1000); index++) {
                dates[index] = new Date(date.getFullYear(), date.getMonth(), date.getDate() + index);
            }

            var models = new Array();

            for (let index = 0; index < dates.length; index++) {
                var dateInfo = new Object();
                dateInfo.title = "윤인재 원장";
                dateInfo.start = dates[index].getFullYear() + "-" + ("0" + (Number(dates[index].getMonth()) + 1)).slice(-2) + "-" + ("0" + dates[index].getDate()).slice(-2) + "T16:00:00";

                models.push(dateInfo);
            }

            for (let index = 0; index < dates.length; index++) {
                var dateInfo = new Object();
                dateInfo.title = "지혜수 원장";
                dateInfo.start = dates[index].getFullYear() + "-" + ("0" + (Number(dates[index].getMonth()) + 1)).slice(-2) + "-" + ("0" + dates[index].getDate()).slice(-2) + "T16:00:00";

                models.push(dateInfo);
            }

            for (let index = 0; index < dates.length; index++) {
                var dateInfo = new Object();
                dateInfo.title = "나현재 원장";
                dateInfo.start = dates[index].getFullYear() + "-" + ("0" + (Number(dates[index].getMonth()) + 1)).slice(-2) + "-" + ("0" + dates[index].getDate()).slice(-2) + "T16:00:00";

                models.push(dateInfo);
            }

            for (let index = 0; index < dates.length; index++) {
                var dateInfo = new Object();
                dateInfo.title = "방은호 원장";
                dateInfo.start = dates[index].getFullYear() + "-" + ("0" + (Number(dates[index].getMonth()) + 1)).slice(-2) + "-" + ("0" + dates[index].getDate()).slice(-2) + "T16:00:00";

                models.push(dateInfo);
            }

            for (let index = 0; index < dates.length; index++) {
                var dateInfo = new Object();
                dateInfo.title = "김태형 원장";
                dateInfo.start = dates[index].getFullYear() + "-" + ("0" + (Number(dates[index].getMonth()) + 1)).slice(-2) + "-" + ("0" + dates[index].getDate()).slice(-2) + "T16:00:00";

                models.push(dateInfo);
            }
            var date = new Date();

            let vueData = revData.$data;

            var iterateData = function(data) {
                for (var key in data) {
                    if (data.hasOwnProperty(key)) {
                        console.log(data[key].id);
                    }
                }
            };

            console.log(iterateData(vueData.info))


            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialDate: "2020-11-04",
                //date.getFullYear() + "-" + ("0" + Number(date.getMonth()) - 1).slice(-2) + "-" + ("0" + date.getDate()).slice(-2),
                editable: false,
                selectable: false,
                businessHours: true,
                dayMaxEvents: true, // allow "more" link when too many events
                eventBorderColor: "#3788d8",
                events: models,

                eventClick: function(arg) {
                    if (localStorage.getItem("animal_admin") == null) {
                        var loginLocation = confirm('로그인 이후 사용 가능합니다. 로그인 하시겠습니까?')
                        if (loginLocation) {
                            location.href = "login.html"
                        }
                    } else {
                        revData.$data.revDoctor = arg.event.title;
                        revData.$data.revDate = (arg.event.start.getFullYear() + "-" + ("0" + (Number(arg.event.start.getMonth()) + 1)).slice(-2) + "-" + ("0" + arg.event.start.getDate()).slice(-2));
                    }
                },
            });

            calendar.render();
        });

        function locationBack() {
            location.reload(true);
        }
    </script>
</head>

<body>
    <div class="wrapper">
        <div class='inner-wrapper'>
            <header include-html='./source/header.html'></header>
            <br><br><br><br><br>
            <section class='visual'>
                </header>
                <div id='calendar'></div>
                <br>
                <div id="rev_app">
                    <span v-if="revDoctor==''"> 
            <br><br><br><br><br><br><br><br><br><br><br><br>

            <img src="https://www.flaticon.com/svg/static/icons/svg/0/49.svg" style="opacity: 0.5; width: 100px; display: block; margin: 0px auto;"><br><br>
            <h2 style="display: block; margin: 0px auto; opacity: 0.5; text-align: center;">왼쪽의 날짜와 원장님을 선택해주세요.</h2>
            </span>
                    <form action="#" method="POST" name="frmForm" id="_frmForm" @submit.prevent="reservation" v-else>
                        <table class="type05">
                            <thead>

                                <h2 style="text-align: center;"> 예약 상세조회<button id="button2" onclick="locationBack()">Back</button></h2><br>
                            </thead>
                            <tr>
                                <th scope="row">예약날짜</th>
                                <td>{{revDate}}</td>
                            </tr>
                            <tr>
                                <th scope="row">동물카테고리</th>
                                <td>
                                    <select class="select" required v-model="revAnimalType">
                                <option value="" disabled selected hidden>동물종류를 선택해주세요</option>
                                <option>멍멍이</option>
                                <option>냥이</option>
                                <option>조류</option>
                                <option>파충류</option>
                                <option>기타</option>
                            </select>
                                </td>
                            </tr>
                            <tr>
                                <th scope="row">담당의사
                                </th>
                                <td>{{revDoctor}}</td>
                            </tr>
                            <tr>
                                <th scope="row">증상
                                </th>
                                <td><textarea placeholder="반려동물의 증상을 200자 이내로 입력해주세요." cols="50" rows="8" style="border-radius: 6px;" v-model="revComment"></textarea></td>
                            </tr>
                            <tr>
                                <td colspan="2" style="text-align: center;"><button id="button" type="submit">예약하기</button></td>
                            </tr>
                        </table>
                    </form>
                </div>
            </section>
        </div>

        <br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>

        <footer include-html='./source/footer.html'></footer>
        <script>
            var revData = new Vue({
                el: "#rev_app ",
                data() {
                    return {
                        info: [],
                        loading: true,
                        errored: false,
                        revDate: "",
                        revDoctor: "",
                        revComment: "",
                        revAnimalType: "",
                        custId: localStorage.getItem("animal_login"),
                        title: ""
                    } //return 
                }, //date

                methods: {
                    reservation() {
                        axios
                            .post("http://127.0.0.1:7000/mijung/reservation", {
                                revDate: this.revDate,
                                revDoctor: this.revDoctor,
                                revComment: this.revComment,
                                revAnimalType: this.revAnimalType,
                                custId: this.custId
                            }) //post
                            .then(function(response) {
                                alert("예약 완료되셨습니다.");
                                location.reload(true)
                            }) //then
                            .catch(error => {
                                console.log(error);
                                this.errored = true
                                alert("예약 실패하셨습니다.");
                            }) //catch
                            .finally(() => this.loading = false)
                    } //reservation
                }, //methods
                mounted() {
                    axios
                        .get("http://127.0.0.1:7000/mijung/getAllReservation")
                        .then(response => {
                            this.info = response.data
                        })
                        .catch(error => {
                            console.log(error);
                            this.errored = true
                        })
                        .finally(() => this.loading = false)
                },

            }); //vue
            new Vue({
                el: "#app",
                data: {
                    isLogin: false
                },
                mounted() {
                    if (localStorage.getItem("animal_login") != null) {
                        this.isLogin = true;
                    }
                },
                methods: {
                    logout() {
                        let con_logout = confirm("로그아웃 하시겠습니까");
                        if (con_logout) {
                            localStorage.removeItem("animal_login");
                            localStorage.removeItem("animal_admin");
                            location.reload(true);
                        }
                    }
                }
            });
        </script>
    </div>
</body>
<script>
    includeHTML();
</script>

</html>