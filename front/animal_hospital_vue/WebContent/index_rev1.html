<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Document</title>
    <script src='./WEB-INF/lib/main.js'></script>
    <link href='./WEB-INF/lib/main.css' rel='stylesheet' />
    <link href='index1.css' rel='stylesheet'>
    <script src="https://unpkg.com/vue"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.18.0/axios.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/vue"></script>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            var calendarEl = document.getElementById('calendar');
            dates = [];
            doctors = ["윤인재 원장", "지혜수 원장", "나현재 원장"];
            const date1 = new Date(2019, 10, 1);
            const date2 = new Date(2021, 1, 1);
            for (let index = 0; index < (date2 - date1) / (3600 * 24 * 1000); index++) {
                dates[index] = new Date(2020, 5, 1 + index);
            }

            var models = new Array();

            for (let index = 1; index < dates.length; index++) {
                var dateInfo = new Object();
                dateInfo.title = "윤인재 원장";
                dateInfo.start = dates[index].getFullYear() + "-" + ("0" + (Number(dates[index].getMonth()) + 1)).slice(-2) + "-" + ("0" + dates[index].getDate()).slice(-2) + "T16:00:00";
                console.log(doctors[index]);
                models.push(dateInfo);
            }

            for (let index = 1; index < dates.length; index++) {
                var dateInfo = new Object();
                dateInfo.title = "지혜수 원장";
                dateInfo.start = dates[index].getFullYear() + "-" + ("0" + (Number(dates[index].getMonth()) + 1)).slice(-2) + "-" + ("0" + dates[index].getDate()).slice(-2) + "T16:00:00";
                console.log(doctors[index]);
                models.push(dateInfo);
            }

            for (let index = 1; index < dates.length; index++) {
                var dateInfo = new Object();
                dateInfo.title = "나현재 원장";
                dateInfo.start = dates[index].getFullYear() + "-" + ("0" + (Number(dates[index].getMonth()) + 1)).slice(-2) + "-" + ("0" + dates[index].getDate()).slice(-2) + "T16:00:00";
                console.log(doctors[index]);
                models.push(dateInfo);
            }

            for (let index = 1; index < dates.length; index++) {
                var dateInfo = new Object();
                dateInfo.title = "방은호 원장";
                dateInfo.start = dates[index].getFullYear() + "-" + ("0" + (Number(dates[index].getMonth()) + 1)).slice(-2) + "-" + ("0" + dates[index].getDate()).slice(-2) + "T16:00:00";
                console.log(doctors[index]);
                models.push(dateInfo);
            }

            for (let index = 1; index < dates.length; index++) {
                var dateInfo = new Object();
                dateInfo.title = "김태형 원장";
                dateInfo.start = dates[index].getFullYear() + "-" + ("0" + (Number(dates[index].getMonth()) + 1)).slice(-2) + "-" + ("0" + dates[index].getDate()).slice(-2) + "T16:00:00";
                console.log(doctors[index]);
                models.push(dateInfo);
            }
            var date = new Date();

            var calendar = new FullCalendar.Calendar(calendarEl, {
                initialDate: date.getFullYear() + "-" + ("0" + date.getMonth()).slice(-2) + "-" + ("0" + date.getDate()).slice(-2),
                editable: false,
                selectable: false,
                businessHours: true,
                dayMaxEvents: true, // allow "more" link when too many events
                events: models,

                eventClick: function(arg) {
                    if (confirm('해당 날짜에 예약하시겠습니까?')) {
                        revData.$data.revDoctor = arg.event.title;
                        revData.$data.revDate = (arg.event.start.getFullYear() + "-" + ("0" + (Number(arg.event.start.getMonth()) + 1)).slice(-2) + "-" + ("0" + arg.event.start.getDate()).slice(-2));
                    }
                },
            });

            calendar.render();
        });
    </script>
    <style>
        body {
            margin: 40px 10px;
            padding: 0;
            font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
            font-size: 14px;
        }
        
        #calendar {
            width: 900px;
            margin-right: 3%;
            margin-left: 5%;
            float: left;
        }
        
        table.type05 {
            border-collapse: separate;
            border-spacing: 1px;
            line-height: 1.5;
            border-top: 1px solid #ccc;
            margin: 20px 10px;
            border-radius: 5px;
            width: 500px;
        }
        
        table.type05 th {
            width: 100px;
            font-weight: bold;
            vertical-align: top;
            border-bottom: 1px solid #ccc;
            background: #2c3e50;
            color: white;
            vertical-align: middle;
            margin: auto;
            border-radius: 5px;
        }
        
        table.type05 td {
            width: 100px;
            padding: 10px;
            vertical-align: top;
            border-bottom: 1px solid #ccc;
        }
        
        #button {
            background-color: #2c3e50;
            color: #fff;
            font-size: 16px;
            border-radius: 10px;
            padding: 12px 100px;
            font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
        }
        
        #button:hover {
            background-color: slategrey;
            font-size: 16px;
            border-radius: 10px;
            padding: 12px 100px;
            font-family: Arial, Helvetica Neue, Helvetica, sans-serif;
        }
        
        select {
            width: 200px;
            padding: .8em .5em;
            font-family: inherit;
            background: url(https://farm1.staticflickr.com/379/19928272501_4ef877c265_t.jpg) no-repeat 95% 50%;
            border: 1px solid #999;
            border-radius: 5px;
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
        }
        
        textarea {
            border-radius: 5px;
        }
    </style>
    </script>
</head>

<body>
    <!-- 상단 -->
    <div class='wrapper'>
        <!-- 상단 메뉴 -->
        <div id='header-fixed' class=''>
            <div class='header-left'>
                <h1 class='header-logo'>
                    <!-- 주소 연결 -->
                    <a href='index1.html'>
                        <img src='img/logo.png' alt='logo' title>
                    </a>
                    <span>
                    "우리 병원 이름은?!"<br>
                        <strong>
                            <i class='logo-span-down'></i>
                            "하루 한건"
                        </strong>
                    </span>
                </h1>
            </div>
            <div class='header-center'>
                <ul class='dropdown-menu'>
                    <li class='dropdown division'>
                        <a class='active' href=#>
                            병원소개
                        </a>
                    </li>
                    <li class='dropdown division'>
                        <a class='active' href="index_rev1.html">
                            진료예약
                        </a>
                    </li>
                    <li class='dropdown division'>
                        <a class='active' href=#>
                            Q&A
                        </a>
                    </li>
                </ul>
            </div>
            <div class='header-right'>
                <div class='header-login'>
                    <ul class='list-unstyled'>
                        <li class='btn-login'>
                            <!-- login 이동 -->
                            <a href="#" class=''>
                                <i class=''></i>
                                <span>Login</span>
                            </a>
                        </li>
                        <li>
                            <!-- 회원가입 -->
                            <a href='#' class=''>
                                <i class=''></i>
                                <span>회원가입</span>
                            </a>
                        </li>

                    </ul>
                </div>
            </div>
        </div>
        <br><br><br><br>
        <div id='calendar'></div>
        <br>
        <div id="app">
            <span v-if="revDoctor==''"> 
            <br><br><br><br><br><br><br><br><br>

            <img src="https://www.flaticon.com/svg/static/icons/svg/0/49.svg" style="opacity: 0.5; width: 100px; display: block; margin: 0px auto;"><br><br>
            <h2 style="display: block; margin: 0px auto; opacity: 0.5; text-align: center;">왼쪽의 날짜와 원장님을 선택해주세요.</h2>
            </span>
            <form action="#" method="POST" name="frmForm" id="_frmForm" @submit.prevent="reservation" v-else>
                <table class="type05">
                    <thead>
                        <h2 style="text-align: center;">예약 상세조회</h2>
                    </thead>
                    <tr>
                        <th scope="row">예약날짜</th>
                        <td>{{revDate}}</td>
                    </tr>
                    <tr>
                        <th scope="row">동물카테고리</th>
                        <td>
                            <select required v-model="revAnimalType">
                                <option value="" disabled selected hidden>동물종류를 선택해주세요</option>
                                <option>멍멍이</option>
                                <option>냥이</option>
                                <option>조류</option>
                                <option>파충류</option>
                                <option>기타</option>
                            </select>
                        </td>
                    </tr>
                    <tr>
                        <th scope="row">담당의사
                        </th>
                        <td>{{revDoctor}}</td>
                    </tr>
                    <tr>
                        <th scope="row">증상
                        </th>
                        <td><textarea placeholder="반려동물의 증상을 200자 이내로 입력해주세요." cols="50" rows="8" v-model="revComment"></textarea></td>
                    </tr>
                    <tr>
                        <td colspan="2" style="text-align: center;"><button id="button" type="submit">예약하기</button></td>
                    </tr>
                </table>

            </form>


        </div>
    </div>
    <script>
        var revData = new Vue({
            el: "#app ",
            data: {
                loading: true,
                errored: false,
                revDate: "",
                revDoctor: "",
                revComment: "",
                revAnimalType: "",
                custId: "",
                title: "",


            }, //data,
            methods: {
                reservation() {
                    axios
                        .post("http://127.0.0.1:7000/mijung/reservation", {
                            revDate: this.revDate,
                            revDoctor: this.revDoctor,
                            revComment: this.revComment,
                            revAnimalType: this.revAnimalType,
                            custId: this.custId
                        }) //post
                        .then(function(response) {
                            alert('${app.custId}님이 등록되셨습니다.');
                            location.href = "./index.html";
                        }) //then
                        .catch(error => {
                            console.log(error);
                            this.errored = true
                        }) //catch
                        .finally(() => this.loading = false)
                } //reservation
            } //methods
        }); //vue
    </script>
</body>

</html>